---
rules:
  - description: "Management → Everywhere (controller + SSH)"
    source:
      network: "Management"
    destination:
      type: "any"
    action: "accept"
    ports: ["22", "443", "8443", "161"]

  - description: "trusted-devices → servers (DNS, AD, NFS, Influx, PXE)"
    source:
      network: "trusted-devices"
    destination:
      network: "servers"
    action: "accept"
    ports: ["53", "67", "68", "69", "88", "389", "636", "2049", "4011", "8086"]
    comment: "Consolidated server access including PXE boot (DHCP, TFTP, ProxyDHCP)"

  - description: "trusted-devices → voip (SIP + RTP)"
    source:
      network: "trusted-devices"
    destination:
      network: "voip"
    action: "accept"
    ports: ["5060-5061", "10000-20000"]

  - description: "servers → osTicket (AI triage polling)"
    source:
      network: "servers"
      address: "10.0.10.60"
    destination:
      address: "10.0.30.40"
      ports: ["80", "443"]
    action: "accept"

  - description: "voip → servers (FreePBX → AD auth)"
    source:
      network: "voip"
    destination:
      network: "servers"
      ports: ["389", "636"]
    action: "accept"

  - description: "guest-iot → WAN only (block local)"
    source:
      network: "guest-iot"
    destination:
      type: "internet"
    action: "accept"

  - description: "guest-iot → local (drop everything else)"
    source:
      network: "guest-iot"
    destination:
      type: "local"
    action: "drop"

  - description: "trusted-devices → guest-iot (printer access only)"
    source:
      network: "trusted-devices"
    destination:
      network: "guest-iot"
      ports: ["9100", "515", "631"]
    action: "accept"

  - description: "All networks → RADIUS (802.1X auth)"
    source:
      type: "any"
    destination:
      address: "10.0.10.11"
      ports: ["1812", "1813"]
    action: "accept"

  - description: "VLAN 10 → Pi-hole Upstream DNS (Phase 3 Endgame Arch)"
    source:
      network: "servers"
    destination:
      address: "10.0.10.11"
      ports: ["53"]
    action: "accept"
    comment: "Pi-hole on separate host (not on AD/DC) for zero DNS conflict. Samba AD forwards non-AD queries upstream."
